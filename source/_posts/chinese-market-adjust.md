---
title: 中国股市的复权
date: 2016-02-01 21:54:12
tags: 股市, 数据
---

在沪深上市企业发生配股、分红、赠股时，由于流通股数的变化，以及公司市值的变化，导致最后一个交易日的收盘价不能准确反映股票的价值。因而，交易所会对于最后一个交易日的收盘价进行一些修正，也就是昨收的修正。昨收在新的交易日可以作为一个初始的指导价格，虽然股票的最终价格还是由买卖双方通过市场来确定的，但正确修正的昨收价格设定任然有着多方面的意义。

<!--more-->

## 复权的意义

首先，交易所给出的昨收价格是用来确定第二天的涨跌停价格的，而如果交易所的昨收价格不合理，则也会导致涨跌停价格的不合理，从而导致股票价格无法在涨跌停范围内落入到其实际价值位置，并且可能导致一些人的错误投资。

其次，正确修正后的历史价格才会对数据的技术分析有用。例如最简单的移动平均值，以及支撑位股价等，都和历史价格有关，而不同的复权修正也会极大的影响这些数值。

## 交易所的复权

交易所修正昨日收盘价的基本思路为：
```
复权后的股价P' * 现在的股数 M' = 之前的总市值A + 总市值的变化 D
之前的总市值A = 之前的股价P * 之前的股数 M
```
我们所要求的值就是`P'`

我们分析三种典型的事件：

### 纯粹的赠股
例如 宏昌电子(603002)在2015年12月23日除权除息，事件为10转5股，其作用主要是增多了流通股数，而对公司流通市值没有影响，具体为:
```
M' = 1.5M
D = 0
```
因此得到
```
P' * 1.5M = P * M
P' = P/1.5
```
在今天(2016-02-01)看到的2015年12月22日的前复权收盘价格为：8.107，原始价格为12.16，符合推算公式。

### 赠股加现金分红
例如 吉祥航空(603885)在2015年12月28日除权除息，事件为10转10股，每10股现金分红 6元。它增加了流通股数，又因为分红，公司的流通市值需要扣去花费的现金，具体为：
```
M' = 2M
D = - 6*(M/10)
```
因此得到
```
P' * 2M = P * M - 0.6M
P' = 0.5P-0.3
```
在今天(2016-02-01)看到的2015年12月25日的前复权收盘价为：37.2元，原始价格为：75.0，符合推算公式。

### 配股
例如 隆基机械(002363)在2016年2月1日除权除息，事件为每十股配三股，每股5.57元。配股同样增多了流通股数，同时公司的流通市值增加了配股售卖得到的资金。但是，配股数是持股人能按设定价格购买的上限，也就是可能没有全部卖完。因此，流通股数的变化和市值的变化需要参考实际的销售情况。从我所看到的几个配股发行结果公告来看，深圳交易所的股票都会给出一个等效的配股售卖数量。例如下图：

![隆基机械 配股发行结果公告](/images/2016/02/002363-adjust.png)

但是，上海交易所的股票虽然也会给出售卖情况，但是交易所在设定昨收时，我所看到的近期的例子中（太平洋 601099 2016年1月25日），没有参考售卖情况，而是直接按照全部售卖成功的情况进行处理。

另外，很多股票软件（大智慧，通达信，富途牛牛等）无论沪深股市，都是用的全部售空情况进行的处理。这会导致一些深市股票在除权除息后的当日昨收（交易所给出）与上一个交易日前复权后的收盘价（股票软件计算）不一致，如下图：
![隆基机械 2015/02/01昨收](/images/2016/02/preclose.png)
![隆基机械 2015/01/21前复权收盘](/images/2016/02/ltd-close.png)

设出售比例设为每十股配`a`股,对于这次隆基机械的配股，股票软件用的是3，而深圳交易所用的是2.9141。具体得到：
```
M' = M+(M/10)*a
D = (M/10)*a*5.57
```
因此得到
```
P'*(M+M/10*a)=P*M+(M/10)*a*5.57
P'=(P+5.57a/10)/(1+a/10)
```
2015年1月21日的隆基机械的原始股价为14.63，当a为3时，得到复权后股价为12.539，与12.54的股票软件复权价相符。当a为2.9141时，得到复权后股价为12.586，与12.59的交易所昨收相符。

## 更久远历史的复权
以上主要讨论的是交易所的复权，而交易所只关心上一个交易日一天的除权除息，从而给新的一天提供指导。但对于股票分析软件或者量化投资者而言，更久远历史的复权也是非常有必要的。

很多股票分析软件（大智慧，通达信，富途牛牛等），都是按照交易所的公式，将更早交易日的原始股价代入公式后求解复权后股价（在细节上有所差异，如之前所说的深市配股情况）。这种方案的主要缺点包括：

1. 计算复杂，尤其是复权次数多了之后。
2. 现金分红会导致公司市值下降，甚至在公司早期原本市值较低的情况下，出现扣除分红后负市值的情况，从而导致负的复权后价格。负数价格对于很多技术指标计算是有害的，例如几何平均值。
3. 导致复权后单日的涨跌幅发生变化。

因此存在另一流派，直接用交易所给出的除权除息日昨收和上一交易日的实际收盘价相除得到一个复权因子，再将历史股价乘以这个因子得到前复权的股价。这种方案计算简单，在多次复权之后任然只是一个简单的因子乘法。并且不会产生负数股价，不会影响单日涨跌幅。新浪财经，优矿，万德所给的数据都是依据这种方案进行复权。其中万德的方案有些特殊，他所用来求解复权因子的昨收不是交易所公式给的昨收，而是类似于股票软件方案的昨收，差异在于深市股票对于实际配股售卖情况的考量。
